# Lineplot Trend

```{r} 
trend_3$group <- subset(trend_3$group, (trend_3$group$mhg %in% c("einET", "ersteGen")) |
                            (trend_3$group$TR_BUNDESLAND == "total" & is.na(trend_3$group$mhg)))

trend_3_prepped <- prep_lineplot(
  
)

  p <- plot_lineplot(trend_3,
    groups = "mhg",
    parameter = "mean",
    line_sig = "trend",
    # line_se = "trend",
    years_lines = list(c(2009, 2015), c(2015, 2022)),
    years_braces = list(c(2009, 2015), c(2015, 2022)),
    facets = "TR_BUNDESLAND",
    facet_values = unique(trend_3$group$TR_BUNDESLAND)[unique(trend_3$group$TR_BUNDESLAND) != "total"],
    seperate_plot_var_box = "wholeGroup",
    point_values = "none",
    point_sig = "none",
    brace_label_est = "trend",
    brace_label_se = "trend",
    brace_label_sig_high = "trend",
    brace_label_sig_bold = "trend",
    title_superscripts = NULL,
    plot_settings = plotsettings_lineplot(
      split_plot = FALSE,
      default_list = lineplot_4x4
    )
  )


  # save_plot(p, filename = "/home/nick/Downloads/test.pdf")

```



# Trend Lesen Deutsch


```{r}
dat_prepped <- prep_tablebarplot(trend_3, par = c("mean", "sd")) %>%
  filter(mhg %in% c("aohneZWH", "einET"), !str_detect(TR_BUNDESLAND, "- total")) %>%
  select(comparison, TR_BUNDESLAND, parameter, year, est, se, es, sig, mhg) %>%
  pivot_wider(names_from = c(year, comparison, parameter), values_from = c(est, se, es, sig)) %>%
  mutate(y_axis = 1:nrow(.)) %>%
  as.data.frame() %>%
  arrange(TR_BUNDESLAND)

dat_prepped$TR_BUNDESLAND[duplicated(dat_prepped$TR_BUNDESLAND)] <- " "

column_widths_stand <- standardize_column_width(
  column_widths = list(
    p1 = c(0.05, 0.05, rep(0.05, 7), NA),
    p2 = c(rep(0.05, 7), NA)
  ),
  plot_ranges = c(80, 120) # Range of the x-axes of both plots set in 'axis_x_lims'.
)

p_1 <- plot_tablebar(
  dat = dat_prepped,
  bar_est = "est_2015 - 2009_trend_mean",
  bar_label = NULL,
  bar_sig = "sig_2015 - 2009_trend_mean",
  bar_fill = "mhg",
  column_spanners = list(
    "**2009**<sup>a</sup>" = c(3, 4),
    "**2015**<sup>a</sup>" = c(5, 6),
    "**Differenz 2015-2009<sup>a</sup>**" = c(7, 10)
  ),
  headers = list(
    "**Land**",
    " ",
    "*M*",
    "*SD*",
    "*M*",
    "*SD*",
    "M<sub>2015</sub> - M<sub>2009</sub>",
    "*(SE)*",
    "*d*",
    " "
  ),
  columns_table = c(
    "TR_BUNDESLAND",
    "mhg",
    "est_2009_none_mean",
    "est_2009_none_sd",
    "est_2015_none_mean",
    "est_2015_none_sd",
    "est_2015 - 2009_trend_mean",
    "se_2015 - 2009_trend_mean",
    "es_2015 - 2009_trend_mean"
  ),
  columns_table_sig_bold = list(
    NULL,
    NULL,
    "sig_2009_none_mean",
    NULL, "sig_2015_none_mean",
    NULL,
    "sig_2015 - 2009_trend_mean",
    NULL,
    NULL
  ),
  y_axis = "y_axis",
  plot_settings = plotsettings_tablebarplot(
    axis_x_lims = c(-40, 40),
    background_stripes_colour = c(rep(c("white", "white", "#EBFDF3", "#EBFDF3"), 8), "grey", "grey"),
    bar_fill_colour = c("#20D479", "#8DEBBC"),
    columns_alignment = c(0, 0, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5),
    columns_width = column_widths_stand$p1,
    headers_alignment = c(0, 0, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0),
    default_list = barplot_table_plot_pattern
  )
)

p_2 <- plot_tablebar(
  dat = dat_prepped,
  bar_est = "est_2022 - 2015_trend_mean",
  bar_label = NULL,
  bar_sig = "sig_2022 - 2015_trend_mean",
  bar_fill = "mhg",
  column_spanners = list(
    "**2015**" = c(1, 2),
    "**2022**" = c(3, 4),
    "**Differenz 2022-2015**" = c(5, 8)
  ),
  headers = list(
    "*M*",
    "*SD*",
    "*M*",
    "*SD*",
    "M<sub>2022</sub> - M<sub>2015</sub>",
    "*(SE)*",
    "*d*",
    " "
  ),
  columns_table = c(
    "est_2015_none_mean",
    "est_2015_none_sd",
    "est_2022_none_mean",
    "est_2022_none_sd",
    "est_2022 - 2015_trend_mean",
    "se_2022 - 2015_trend_mean",
    "es_2022 - 2015_trend_mean"
  ),
  columns_table_se = list(NULL, NULL, NULL, NULL, NULL, "se_2015 - 2009_trend_mean", NULL),
  columns_table_sig_bold = list(
    "sig_2015_none_mean",
    NULL,
    "sig_2022_none_mean",
    NULL,
    "sig_2022 - 2015_trend_mean",
    NULL,
    NULL
  ),
  y_axis = "y_axis",
  plot_settings = plotsettings_tablebarplot(
    axis_x_lims = c(-60, 60),
    background_stripes_colour = c(rep(c("white", "white", "#EBFDF3", "#EBFDF3"), 8), "grey", "grey"),
    bar_fill_colour = c("#20D479", "#8DEBBC"),
    columns_alignment = c(0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5),
    columns_width = column_widths_stand$p2,
    headers_alignment = c(0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0),
    default_list = barplot_table_plot_pattern
  )
)
example_plot <- combine_plots(list(p_1, p_2))
# save_plot(example_plot, filename = "C:/Users/hafiznij/Downloads/test_table.pdf")
save_plot(example_plot, filename = "/home/nick/Downloads/test_table.pdf", width = 320)
```


```{r}
dat_prepped_crossdiff <- prep_tablebarplot(trend_3, par = c("mean", "sd")) %>%
  filter(comparison == "crossDiff_of_groupDiff") %>%
  select(comparison, TR_BUNDESLAND, parameter, year, est, se, es, sig, mhg) %>%
  pivot_wider(names_from = c(year, comparison, parameter), values_from = c(est, se, es, sig)) %>%
  mutate(y_axis = 1:nrow(.)) %>%
  as.data.frame() %>%
  arrange(TR_BUNDESLAND)
```

